"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),r=require("@react-three/fiber"),n=require("three"),t=require("three-stdlib"),s=require("../helpers/environment-assets.cjs.js");function a(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var t=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,t.get?t:{enumerable:!0,get:function(){return e[n]}})}})),r.default=e,Object.freeze(r)}var u=a(e);const o=e=>{return(r=e).current&&r.current.isScene?e.current:e;var r};function c({children:e,near:t=1,far:s=1e3,resolution:a=256,background:c=!1,scene:p,files:l=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:g="",preset:f,extensions:b}){const d=r.useThree((e=>e.gl)),m=r.useThree((e=>e.scene)),y=u.useRef(null),[h]=u.useState((()=>new n.Scene)),v=u.useMemo((()=>{const e=new n.WebGLCubeRenderTarget(a);return e.texture.type=n.HalfFloatType,e}),[a]);return u.useLayoutEffect((()=>{y.current.update(d,h);const e=o(p||m),r=e.background,n=e.environment;return e.environment=v.texture,c&&(e.background=v.texture),()=>{e.environment=n,e.background=r}}),[e,p]),u.createElement(u.Fragment,null,r.createPortal(u.createElement(u.Fragment,null,e,u.createElement("cubeCamera",{ref:y,args:[t,s,v]}),(l||f)&&u.createElement(i,{background:!0,files:l,preset:f,path:g,extensions:b,scene:h})),h))}function i({background:e=!1,files:a=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:c="",preset:i,scene:p,extensions:l}){if(i){if(!(i in s.presetsObj))throw new Error("Preset must be one of: "+Object.keys(s.presetsObj).join(", "));a=s.presetsObj[i],c="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}const g=r.useThree((e=>e.scene)),f=Array.isArray(a),b=f?n.CubeTextureLoader:t.RGBELoader,d=r.useLoader(b,f?[a]:a,(e=>{e.setPath(c),null==e.setDataType||e.setDataType(n.FloatType),l&&l(e)})),m=f?d[0]:d;return m.mapping=n.EquirectangularReflectionMapping,u.useLayoutEffect((()=>{const r=o(p||g),n=r.background,t=r.environment;return r.environment=m,e&&(r.background=m),()=>{r.environment=t,r.background=n,m.dispose()}}),[m,e,p]),null}exports.Environment=function(e){return e.children?u.createElement(c,e):u.createElement(i,e)},exports.EnvironmentMap=i,exports.EnvironmentPortal=c;
